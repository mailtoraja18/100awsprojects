<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
  
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  

  
  <title>Experiment with SAM Local</title>

    

  
  
    <link rel="stylesheet" href="https://100awsprojects.com/css/table.css">
  

  
  

  
  <link rel="stylesheet" href="/css/hugo-octopress.css">

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

  
  <link href="https://100awsprojects.com/favicon.png" rel="icon">

  
  
  

  

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="author" content="Rajaram Kumar">

  
  <meta name="generator" content="Hugo 0.32.4" />

  
  
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-XXXXX-X', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


</head>
<body>


<header role="banner"><hgroup>
  
  <h1><a href="https://100awsprojects.com/">100 AWS Projects</a></h1>
    <h2>AWS Projects to get you started</h2>
</hgroup></header>


<nav role="navigation">
<fieldset class="mobile-nav">
  
  <select onchange="location = this.value;">
    <option value="">Navigate…</option>
      
        <option value="https://100awsprojects.com/">» All Posts</option>
      
        <option value="https://100awsprojects.com/awslinks/">» AWS Links</option>
      
        <option value="https://100awsprojects.com/tweets/">» Tweets</option>
      
        <option value="https://100awsprojects.com/about/">» About</option>
      

  </select>
</fieldset>


<ul class="main-navigation">
  
  
    
      <li><a href="https://100awsprojects.com/" title="All Posts">All Posts</a></li>
    
  
    
      <li><a href="https://100awsprojects.com/awslinks/" title="AWS Links" >AWS Links</a></li>
    
  
    
      <li><a href="https://100awsprojects.com/tweets/" title="Tweets" >Tweets</a></li>
    
  
    
      <li><a href="https://100awsprojects.com/about/" title="About" >About</a></li>
    
  
</ul>


<ul class="subscription">
  
    
        <a href="https://100awsprojects.com/index.xml" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a>
    
  

</ul>


<form action="https://www.google.com/search" method="get" target="_blank">
  <fieldset role="search">
  	<input class="search" type="text" name="q" results="0" placeholder="Search"/>
    <input type="hidden" name="q" value="site:https://100awsprojects.com/" />
  </fieldset>
</form>

</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<div>
    <p><strong>Mar 21, 2018</strong>
        
        

        
       
          <h3 class="entry-title"> Experiment with SAM Local  </h3>         
    </p>
</div>

        <div class="entry-content">
          
          
          
          
            <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#a-note-about-aws-config-update-endpoint">A Note about AWS Config Update Endpoint</a>
<ul>
<li><a href="#in-windows">In Windows</a></li>
<li><a href="#for-mac">For MAC</a></li>
</ul></li>
<li><a href="#code-resources-and-next">Code Resources and Next</a>
<ul>
<li><a href="#1-download-and-review-code">1) Download and Review Code</a></li>
<li><a href="#2-start-dynamodb-locally-and-create-pet-table">2) Start Dynamodb Locally and Create Pet table</a></li>
<li><a href="#3-load-data">3) Load data</a></li>
<li><a href="#4-start-the-sam-local-from-petclinic-sam-folder">4) Start the SAM-LOCAL from petclinic_sam folder</a></li>
</ul></li>
<li><a href="#test-locally-using-postman">Test Locally using Postman</a></li>
<li><a href="#what-just-happened">What just happened ?</a></li>
<li><a href="#deploy-remote">Deploy Remote</a></li>
<li><a href="#test-remote">Test Remote</a></li>
<li><a href="#delete-stack">Delete Stack</a></li>
</ul></li>
</ul>
</nav>
          
          

<!-- more -->

<p>The goal of AWS SAM is to define a standard application model for serverless applications. With AWS SAM Local you can be used to test functions LOCALLY in your desktop, start a LOCAL API Gateway from a SAM template, validate a SAM template, and generate sample payloads for various event sources. Lets get started to see some SAM Local in action. After testing locally you can package and deploy the functions to remote.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>Go through the url and setup the Prerequisites. <a href="https://github.com/awslabs/aws-sam-local">https://github.com/awslabs/aws-sam-local</a>

<ul>
<li>Install NodeJs</li>
<li>Install Docker CE (Windows or Mac) , start Docker</li>
<li>Execute command <code>npm install -g aws-sam-local</code> to install aws sam local</li>
</ul></li>
<li>In Windows you might need to do the following for Docker.

<ul>
<li>set HOME=C:\Users\user</li>
<li>provide access to your C drive to docker</li>
</ul></li>
<li>Install Dynamo DB Locally and Start

<ul>
<li><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.html)">https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.html)</a></li>
</ul></li>
<li>Start Docker Container

<ul>
<li>use <code>Docker for Windows</code>s shortcut</li>
</ul></li>
<li>Install Postman for testing, <a href="https://app.getpostman.com/app/download/win64">https://app.getpostman.com/app/download/win64</a> , for Mac you can use curl.</li>
</ul>

<h2 id="a-note-about-aws-config-update-endpoint">A Note about AWS Config Update Endpoint</h2>

<p>This endpoint helps you point to the Local Dynamo DB. Be mindful wether your code is pointing locally or remote.</p>

<pre><code> AWS.config.update({
      region: &quot;us-east-1&quot;,
      endpoint: &quot;http://&lt;what to put here ?&gt;:8000&quot;
  }); 
</code></pre>

<h3 id="in-windows">In Windows</h3>

<p>In Docker for Windows, the container communicates through a vEthernet adapter called DockerNAT. To find its details, open Command Prompt and type <code>ipconfig</code>
Look for an entry that looks like</p>

<p>Ethernet adapter vEthernet (DockerNAT):</p>

<pre><code>Connection-specific DNS Suffix  . :
Link-local IPv6 Address . . . . . : fe80::fd29:297:4583:3ad4%4
IPv4 Address. . . . . . . . . . . : 10.0.75.1
Subnet Mask . . . . . . . . . . . : 255.255.255.0
Gateway . . . . . . . . . :
</code></pre>

<p>The IP address to the right of IPv4 Address is the one you need.</p>

<h3 id="for-mac">For MAC</h3>

<p>use this <code>docker.for.mac.localhost</code></p>

<h2 id="code-resources-and-next">Code Resources and Next</h2>

<h3 id="1-download-and-review-code">1) Download and Review Code</h3>

<p>Download the petclinic_sam folder <a href="https://github.com/mailtoraja18/aws_serverless_resources/tree/master/petclinic_sam">https://github.com/mailtoraja18/aws_serverless_resources/tree/master/petclinic_sam</a></p>

<h3 id="2-start-dynamodb-locally-and-create-pet-table">2) Start Dynamodb Locally and Create Pet table</h3>

<ul>
<li>Run <code>java -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar -sharedDb</code></li>
<li>Run <code>node dynamo_pet_create_table.js</code></li>
</ul>

<h3 id="3-load-data">3) Load data</h3>

<ul>
<li>Run <code>node dynamo_pet_load_data.js</code></li>
</ul>

<h3 id="4-start-the-sam-local-from-petclinic-sam-folder">4) Start the SAM-LOCAL from petclinic_sam folder</h3>

<p><code>sam --version</code> and then <code>sam local start-api</code></p>

<p>First time</p>

<pre><code>2018/03/21 18:52:35 Connected to Docker 1.35
2018/03/21 18:52:35 Runtime image missing, will pull....
2018/03/21 18:52:35 Fetching lambci/lambda:nodejs6.10 image for nodejs6.10 runtime...
nodejs6.10: Pulling from lambci/lambda
5be106c3813f: Extracting  192.2MB/324.7MB
e240967675e1: Download complete
95d21be37ff9: Download complete
caf7e45f0ace: Download complete
</code></pre>

<p>You should see the below log next time onwards</p>

<pre><code>2018/03/23 21:42:29 Fetching lambci/lambda:nodejs6.10 image for nodejs6.10 runtime...
nodejs6.10: Pulling from lambci/lambda
Digest: sha256:bc47c223a2accf47c51adc6e1949bda9b557764be38a76ebac73e545044079cc
Status: Image is up to date for lambci/lambda:nodejs6.10
</code></pre>

<p>Then you should see the REST API&rsquo;s deployed (i dont know why it shows the same file for all , bug ?)</p>

<pre><code>Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets [POST]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets/info [POST]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets/status [POST]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets [DELETE]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets/{petId} [GET]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets [GET]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets/status/{status} [GET]
</code></pre>

<h2 id="test-locally-using-postman">Test Locally using Postman</h2>

<p>Use postman to fire away at the REST API&rsquo;s. After you have tested , its time to deploy remotely.</p>

<h2 id="what-just-happened">What just happened ?</h2>

<p>The template.yaml provides the API definitions and the scripts they should point at. We are running the DynamoDB locally here . On AWS you would use
the dynamo db access policy <code>Policies: AmazonDynamoDBFullAccess</code> to access the DynamoDB. The below package and deploy commands will push all teh code to S3 bucket and use clould formation to create
the API Gateway and Lambda function and apply the policy.</p>

<h2 id="deploy-remote">Deploy Remote</h2>

<ul>
<li>create a new bucket like <code>xdr56yhn-aws-sam</code> in your account.</li>
<li><code>sam package --template-file template.yaml --s3-bucket xdr56yhn-aws-sam --output-template-file packaged.yaml</code></li>
<li><code>sam deploy --template-file ./packaged.yaml --stack-name PetStack --capabilities CAPABILITY_IAM</code></li>
</ul>

<h2 id="test-remote">Test Remote</h2>

<p>Pull up the AWS API Gateway page and use the Console Test functionality to test the functions.</p>

<h2 id="delete-stack">Delete Stack</h2>

<p>You just created a AWS Cloudformation Stack. You can get into the page and choose Action &gt; Delete to delete the stact you just created.</p>

        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">Rajaram Kumar</span></span>
    
    <time>Mar 21, 2018</time>
    
    </span>
  </p>

  
  

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://100awsprojects.com/post/2018-02-15-aws-serverless-project-apigateway-integration-part-4/" title="AWS Serverless Project APIGateway Integration Part 4">AWS Serverless Project APIGateway Integration Part 4</a>
    

    
      <a class="basic-alignment right" href="https://100awsprojects.com/post/2018-05-21-api-gateway-using-swagger-and-sam/" title="API Gateway using Swagger and SAM">API Gateway using Swagger and SAM</a>
    
  </p>
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    
      <h1>Who am I ?</h1>
    

    <p>
      
        I am Rajaram Kumar , working as a Java software engineer.
  <br>
  I am interested in AWS and exploring it through projects. I have 2 AWS Certifications , Developer and Architect
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/" title="https://github.com/"><i class="fa fa-github fa-3x"></i></a>
      <a target="_blank" href="https://bitbucket.org/" title="https://bitbucket.org/"><i class="fa fa-bitbucket fa-3x"></i></a>
      
      <a target="_blank" href="https://twitter.com/" title="https://twitter.com/"><i class="fa fa-twitter fa-3x"></i></a>
      <a target="_blank" href="https://keybase.io/" title="https://keybase.io/"><i class="fa fa-key fa-3x"></i></a> 
      
      
      
      
      
      

    
    
    </li>
  </ul>

  

  
    
      <section class="odd">
        
        
      </section>
    
  

  
  
  

</aside>

  </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2018 Rajaram Kumar - <a href="https://100awsprojects.com/license/">License</a> -
  <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
</p>

</footer>






<script>
  var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

